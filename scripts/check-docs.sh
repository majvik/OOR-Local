#!/bin/bash
# check-docs.sh - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
files=("README.md" "CSS_CLASSES.md" "JAVASCRIPT_API.md" "SPEC.md" "DOCUMENTATION_MAINTENANCE.md")
for file in "${files[@]}"; do
  if [ ! -f "$file" ]; then
    echo "‚ùå –§–∞–π–ª $file –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
  else
    echo "‚úÖ –§–∞–π–ª $file —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
  fi
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫ –≤ README.md
echo "üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫ –≤ README.md..."
grep -o '\[.*\](.*)' README.md | while read -r link; do
  if [[ $link == *"("*")"* ]]; then
    url=$(echo "$link" | sed 's/.*(\(.*\)).*/\1/')
    if [[ $url == http* ]]; then
      if ! curl -s --head "$url" | head -n 1 | grep -q "200 OK"; then
        echo "‚ùå –°—Å—ã–ª–∫–∞ $url –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
      else
        echo "‚úÖ –°—Å—ã–ª–∫–∞ $url –¥–æ—Å—Ç—É–ø–Ω–∞"
      fi
    fi
  fi
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π..."
version=$(grep "–í–µ—Ä—Å–∏—è:" README.md | head -1 | sed 's/.*–í–µ—Ä—Å–∏—è: //')
echo "–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $version"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
echo "üìÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è..."
date=$(grep "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:" README.md | head -1 | sed 's/.*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: //')
echo "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: $date"

echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
